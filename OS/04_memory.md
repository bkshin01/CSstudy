# ✔️ 메모리(Memory)

## MMU가 뭔지 설명해 보세요.
MMU는 CPU와 메모리 사이에서 주소의 영역을 설정하는 역할을 합니다.<br>
MMU 내부에는 `재배치 레지스터`가 존재하여 CPU가 요구하는 메모리의 위치와 실제 메모리상의 프로그램 위치를 맞춰줍니다.<br>
즉, 논리적 주소를 물리적 주소로 변환하는 주소 바인딩 작업을 수행합니다.

<br>

## 연속 메모리 할당 방법을 말해보세요.
최초 적합, 최적 적합, 최악 적합으로 세 가지 방법이 있습니다.<br>
최초 적합은 메모리의 시작이나 끝지점부터 탐색하면서 요청받은 프로세스를 할당할 수 있는 공간이 발견되면 곧바로 프로세스를 할당하는 방법입니다.<br>
최적 적합은 전체 메모리에 남은 공간을 다 확인해보고 요청받은 프로세스를 할당할 수 있는 가장 작은 공간에 프로세스를 할당하는 방법입니다.<br>
최악 적합은 전체 메모리에 남은 공간을 다 확인해보고 요청받은 프로세스를 할당할 수 있는 가장 큰 공간에 프로세스를 할당하는 방법입니다.

<br>

## Paging 기법에 대해 설명해 보세요.
Paging은 프로세스가 할당 받은 메모리 공간을 일정한 페이지 단위로 나누어 물리 메모리에서 연속되지 않는 서로 다른 위치에 저장하는 메모리 관리 기법입니다.

<br>

[추가 키워드]
- `page table`: 페이징 기법에서는 주소 바인딩을 위해 모든 프로세스가 각각의 page table을 갖는다.
  - 논리적 메모리에는 페이지 번호가 저장됨 (`PTBR`을 사용해서 페이지 테이블의 포인터를 저장)
  - 페이지 테이블에는 페이지 번호와 실제 메모리에서 프레임의 시작 주소가 저장됨

<br>

## Segmentation 기법에 대해 설명해 보세요.
Segmentation은 프로세스가 할당 받은 메모리 공간을 논리적 의미 단위인 segment로 나누어, 연속되지 않는 물리 메모리 공간에 할당될 수 있도록 하는 메모리 관리 기법입니다.<br>
일반적으로 프로세스의 메모리 영역 중 코드, 데이터, 힙, 스택 등의 기능 단위로 세그멘트를 정의하는 경우가 많다.

<br>

[추가 키워드]
- `segment table`: 세그멘테이션 기법에서는 주소 바인딩을 위해 모든 프로세스가 각각의 segment table을 갖는다.
  - 논리적 주소에는 (세그먼트 번호, 내용 길이)가 저장됨
  - 세그먼트 테이블에는 (세그먼트 번호, 세그먼트 시작점, 세그먼트 길이)가 저장됨
- `segmentation fault`: 논리적 주소에 존재하는 offset의 값이 세그먼트의 limit보다 커져 해당 세그먼트를 넘어가는 오류

<br>

## Paged segmentation 기법에 대해 설명해 보세요.
각 세그먼트를 페이지 단위로 구성하는 메모리 관리 기법입니다.<br>
기존에는 세그먼트의 시작 주소를 세그먼트 테이블에서 바로 구해 메모리에 접근했다면, 이 기법을 사용할 때는 세그먼트에 해당하는 페이지 테이블의 시작 주소를 얻게 됩니다.<br>
이후 페이지 테이블을 통해 페이지 주소를 구해 메모리에 접근하게 됩니다.

<br>

## 메모리 단편화에 대해서 설명해 보세요.
메모리 단편와는 내부와 외부 두 종류가 있습니다.<br>
외부 단편화는 프로세스를 연속 메모리 할당할 때, 흩어진 빈 공간을 합치면 프로세스를 로드할 수 있는 만큼의 여유 공간이 있지만, 각각의 빈 공간들이 요청받은 프로세스를 할당할 수 있는 크기를 가지지 못해 프로세스를 로드할 수 없는 상태를 의미합니다.<br>
내부 단편화는 프로세스를 동일한 크기의 페이지로 분할할 때, 페이지를 모두 다 사용하지 않고 마지막 페이지의 일부만을 사용하여 페이지 내부에 빈 공간이 남게 되는 상태를 의미합니다.

<br>

## 가상 메모리에 대해 설명해 주세요.
프로세스 전체가 메모리에 올라오지 않더라도 실행이 가능하도록 하는 기법입니다.<br>
운영체제는 이 기법을 통해 프로그램의 논리적 주소 영역에서 필요한 부분만 물리적 메모리에 적재하고, 직접적으로 필요하지 않은 메모리 공간은 디스크의 swap 영역에 저장하게 됩니다.

<br>

## Swapping은 무엇인가요?
스와핑은 현재 실행 중이지 않은 메모리에 올라온 프로세스를 메모리 공간을 효율적으로 사용하기 위해 디스크에 임시로 저장하고 필요할 때 다시 불러오는 방법입니다.

<br>

## Swapping 기법의 문제점은?
임시 저장을 디스크에 하기 때문에 속도가 오래 걸립니다.<br>
따라서 실제로 사용할 때는 전체 프로세스를 스와핑하는 것이 아니라 프로세스의 일부인 페이지만 스왑하거나, 디스크 내의 파일 시스템과 분리된 스왑 공간을 만드는 방식으로 구현됩니다.

<br>

## TLB를 왜 쓰고 어떻게 쓰는지 설명해 보세요.
TLB는 가상 메모리 주소를 물리적인 주소로 변환하는 속도를 높이기 위해 사용되는 캐시입니다.<br>
페이지 테이블을 사용할 때 CPU가 요청하는 실제 페이지에 접근하기 위해서는 메모리를 두 번 읽어야 합니다.
먼저 레지스터에 저장된 페이지 테이블 포인터를 읽어 메인 메모리에 있는 페이지 테이블을 읽고, 페이지 테이블에 맵핑된 물리주소에 접근해 값을 가져올 때 한번 더 메모리를 읽게 됩니다.<br>
이때 발생하는 지연시간을 최소화하기 위해서 TLB를 사용합니다.<br>

CPU가 요청하는 페이지의 주소를 찾기 위해 TLB에 해당 논리주소에 맵핑되는 물리주소가 있는지 확인합니다.
만약 존재하면 페이지 테이블을 거치지 않고 바로 물리 주소에 접근하고, 없다면 페이지 테이블을 읽어 물리 주소를 확인한 뒤 작업을 수행합니다.

<br>

## 공유 페이지에 대해서 말해 보세요.
공유 페이지는 똑같은 코드 영역을 사용하는 다수의 프로세스가 있을 때 하나의 페이지만 유지하고 각 프로세스의 페이지 테입르이 해당 페이지를 가르키게 하는 기법입니다.<br>
이를 통해 여러 프로세스가 중복으로 사용하는 페이지를 하나만 유지하여 메모리 공간을 절약할 수 있습니다.<br>
많은 프로그램이 사용하는 라이브러리, 여러 프로세스가 공동으로 사용하는 캐시 데이터 등을 저장할 수 있습니다.

<br>

## 요구 페이징에 대해서 말해 보세요.
가상 메모리 기법을 사용하는 환경에서 CPU가 특정 페이지를 요청한 다음 메모리에 페이징하는 기법을 말합니다.<br>
페이지 테이블의 엔트리에 `valid bit`을 추가하여 각 페이지가 실제 메모리에 존재하는지를 표시하여 구현합니다.<br>
메모리 사용량이 감소하고, 프로세스 전체를 메모리에 입출력하는 오버헤드도 감소하는 장점이 있습니다.

<br>

## Page fault의 처리 방법을 설명해 보세요.
페이지 폴트는 CPU가 무효 비트로 표시된 페이지에 접근하려고 하는 상황을 말합니다.<br>
주소 변환을 담당하는 하드웨어인 MMU가 페이지 폴트 trap을 발생시키고, 디스크에서 페이지를 가져와 메모리의 빈 프레임에 적재하고 페이지 테이블에서 유효 상태로 업데이트 시킵니다.<br>

<br>

## 지역성의 원리에 대해 말해 보세요.
시간적 지역성과 공간적 지역성이 있습니다.<br>
시간적 지역성은 최근에 참조한 메모리 주소를 다시 참조할 가능성이 높다는 것이고, 
공간적 지역성은 어떤 메모리 주소를 참조했을 때 다음에 참조할 메모리는 해당 주소 근처에 있을 확률이 높다는 것을 의미합니다.

<br>

## 페이지 교체 알고리즘에 대해 아는대로 말해주세요.
페이지 폴트가 발생하면 요청된 페이지를 디스크에서 메모리로 가져와야 하지만, 이때 물리적 메모리의 공간이 부족할 수 있습니다. 
그럴 경우에는 메모리에 올라와 있는 페이지를 디스크로 옮겨서 메모리 공간을 확보해야 하고, 이를 페이지 교체라고 합니다.<br>
페이지 교체 알고리즘은 최대한 페이지 폴트가 적게 일어나도록 해야 하므로 앞으로 참조될 가능성이 적은 페이지를 선택해서 교체해야 합니다.<br>

| 알고리즘 | 설명 |
| --- | --- |
| FIFO(First In First Out) | 메모리에 올라온지 가장 오래된 페이지를 교체 |
| 최적 페이지 교체 | 앞으로 가장 오랫동안 사용되지 않을 페이지를 교체. 실제 구현은 어려움. |
| LRU(Least Recently Used) | 가장 오랫동안 사용되지 않은 페이지 교체 |
| LFU(Least Frequently Used) | 참조 횟수가 가장 적은 페이지를 교체. 비용 대비 성능이 좋지 않아 잘 쓰이지 않는 편. |

